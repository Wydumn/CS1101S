var interpreter=6;var mission_type="sound_tone_matrix";var timeout="60000";(function(r){var t={chars:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encLookup:[],Init:function(){for(var r=0;r<4096;r++){this.encLookup[r]=this.chars[r>>6]+this.chars[r&63]}},Encode:function(r){var t=r.length;var e="";var a=0;while(t>2){n=r[a]<<16|r[a+1]<<8|r[a+2];e+=this.encLookup[n>>12]+this.encLookup[n&4095];t-=3;a+=3}if(t>0){var o=(r[a]&252)>>2;var i=(r[a]&3)<<4;if(t>1)i|=(r[++a]&240)>>4;e+=this.chars[o];e+=this.chars[i];if(t==2){var u=(r[a++]&15)<<2;u|=(r[a]&192)>>6;e+=this.chars[u]}if(t==1)e+="=";e+="="}return e}};t.Init();var e=function(r){this.data=[];this.wav=[];this.dataURI="";this.header={chunkId:[82,73,70,70],chunkSize:0,format:[87,65,86,69],subChunk1Id:[102,109,116,32],subChunk1Size:16,audioFormat:1,numChannels:1,sampleRate:8e3,byteRate:0,blockAlign:0,bitsPerSample:8,subChunk2Id:[100,97,116,97],subChunk2Size:0};function n(r){return[r&255,r>>8&255,r>>16&255,r>>24&255]}function e(r){return[r&255,r>>8&255]}function a(r){var t=[];var n=0;var e=r.length;for(var a=0;a<e;a++){t[n++]=r[a]&255;t[n++]=r[a]>>8&255}return t}this.Make=function(r){if(r instanceof Array)this.data=r;this.header.blockAlign=this.header.numChannels*this.header.bitsPerSample>>3;this.header.byteRate=this.header.blockAlign*this.sampleRate;this.header.subChunk2Size=this.data.length*(this.header.bitsPerSample>>3);this.header.chunkSize=36+this.header.subChunk2Size;this.wav=this.header.chunkId.concat(n(this.header.chunkSize),this.header.format,this.header.subChunk1Id,n(this.header.subChunk1Size),e(this.header.audioFormat),e(this.header.numChannels),n(this.header.sampleRate),n(this.header.byteRate),e(this.header.blockAlign),e(this.header.bitsPerSample),this.header.subChunk2Id,n(this.header.subChunk2Size),this.header.bitsPerSample==16?a(this.data):this.data);this.dataURI="data:audio/wav;base64,"+t.Encode(this.wav)};if(r instanceof Array)this.Make(r)};var a=32e3;function o(r){var t=[];for(var n=r.length-1;n>=0;n--){t=pair(r[n],t)}return t}function i(r){var t=[];while(!is_empty_list(r)){t.push(head(r));r=tail(r)}return t}function u(r){var t=0;while(!is_empty_list(r)){t++;r=tail(r)}return t}function f(r,t){var n=i(r);var e=i(t);var a=n.concat(e);return o(a)}function s(r,t){var n=i(t);for(var e=0;e<n.length;e++){n[e]=r(n[e])}return o(n)}function c(r,t){var n=[];for(var e=0;e<t*a;e++){n.push(r(e/a))}return n}function l(r){for(var t=0;t<r.length;t++){r[t]=Math.round((r[t]+1)*126)}return r}function h(r){for(var t=0;t<r.length;t++){if(r[t]>1)r[t]=1;if(r[t]<-1)r[t]=-1}var n=0;for(var t=0;t<r.length;t++){if(Math.abs(n-r[t])>.01&&r[t]==0){r[t]=n*.999}n=r[t]}return r}function v(r){var t=[];for(var n=0;n<r.length;n++){t[n]=r[n]}return t}function d(r){data=v(r);data=h(data);data=l(data);var t=new e;t.header.sampleRate=a;t.header.numChannels=1;t.Make(data);var n=new Audio(t.dataURI);return n}function m(r,t){return pair(r,t)}function p(r){return head(r)}function _(r){return tail(r)}function b(r){return is_pair(r)&&head(r)==="sound"}var y=false;var x=null;function M(r){if(y)return;if(!b(r)){throw new Error("play() expects sound as input, did you forget to sourcesound_to_sound()?")}var t=tail(r);x=d(t);x.addEventListener("ended",k);x.play();y=true}function k(){if(y){x.pause();delete x}y=false}function g(r,t){var n=p(r);return m(function(r){if(r>=t){return 0}else{return n(r)}},t)}function w(r,t){var n=tail(r);var e=[];for(var o=0;o<a*t;o++){e[o]=n[o]}return e}function I(r){return g(r,_(r))}function P(r){var t=_(r);var n=p(r);var e=c(n,t);var a=pair("sound",e);a.toString=function(){return"[object Sound]"};return a}function C(r){if(!b(r)){throw new Error("sound_to_sourcesound() expects sound as input, did you forget to sourcesound_to_sound()?")}var t=tail(r);var n=t.length/a;return I(m(function(r){var n=r*a;var e=Math.floor(n);var o=e+1;var i=n-e;var u=t[o]?t[o]:0;var f=t[e]?t[e]:0;return f*(1-i)+u*i},n))}function A(r){return pair("sound",accumulate(function(r,t){return r.concat(t)},[],s(tail,r)))}function S(r){if(false){debugger}var t=i(s(tail,r));var n=0;var e;var a=[];for(e=0;e<t.length;e++){n=Math.max(n,t[e].length)}for(e=0;e<n;e++){a[e]=0;for(var o=0;o<t.length;o++){var u=t[o][e];a[e]+=u?u:0}a[e]/=t.length}return pair("sound",a)}function E(r){return I(m(function(r){return Math.random()*2-1},r))}function R(r){return P(E(r))}function z(r,t){return I(m(function(t){return Math.sin(2*Math.PI*t*r)},t))}function B(r,t){return P(z(r,t))}function L(r,t){return I(m(function(r){return 0},t))}function U(r){return L(0,r)}function F(r){return L(1,r)}function T(r){return P(U(r))}function q(r){return P(F(r))}function D(r){var t=p(r);var n=_(r);return m(function(r){return-t(r)},n)}function G(r){var t=[];var n=tail(r);for(var e=0;e<n.length;e++){t[e]=-n[e]}return t}function j(r){var t=p(r);var n=_(r);return m(function(r){var n=t(r);if(n>1){return 1}else if(n<-1){return-1}else{return n}},n)}function X(r){var t=[];var n=tail(r);for(var e=0;e<n.length;e++){if(t[e]>1){return 1}else if(t[e]<-1){return-1}else{return t[e]}}return t}function Y(r){var r=r.split("");var t=12;var n=r[0].toUpperCase();switch(n){case"D":t=t+2;break;case"E":t=t+4;break;case"F":t=t+5;break;case"G":t=t+7;break;case"A":t=t+9;break;case"B":t=t+11;break;default:break}if(r.length===2){t=parseInt(r[1])*12+t}else if(r.length===3){switch(r[1]){case"#":t=t+1;break;case"b":t=t-1;break;default:break}t=parseInt(r[2])*12+t}return t}function H(r){return J(note_to_midi_note(r))}function J(r){return 8.1757989156*Math.pow(2,r/12)}function K(r,t){function n(t,n){var e=0;for(var a=1;a<=t;a++){e=e+Math.sin(2*Math.PI*(2*a-1)*r*n)/(2*a-1)}return e}return I(m(function(r){var t=4/Math.PI*n(5,r);if(t>1){return 1}else if(t<-1){return-1}else{return t}},t))}function N(r,t){return P(K(r,t))}function O(r,t){function n(t,n){var e=0;for(var a=0;a<t;a++){e=e+Math.pow(-1,a)*Math.sin((2*a+1)*n*r*Math.PI*2)/Math.pow(2*a+1,2)}return e}return I(m(function(r){var t=8/Math.PI/Math.PI*n(5,r);if(t>1){return 1}else if(t<-1){return-1}else{return t}},t))}function Q(r,t){return P(O(r,t))}function V(r,t){function n(t,n){var e=0;for(var a=1;a<=t;a++){e=e+Math.sin(2*Math.PI*a*r*n)/a}return e}return I(m(function(r){var t=1/2-1/Math.PI*n(5,r);if(t>1){return 1}else if(t<-1){return-1}else{return t}},t))}function W(r,t){return P(V(r,t))}function Z(r){if(!b(r)){throw new Error("play() expects sound as input, did you forget to sourcesound_to_sound()?")}var t=tail(r);var n=d(t);n.play()}var rr="#ffffff";var tr="#666666";var nr="#444444";color_on="#cccccc";color_off="#333333";var er=18;var ar=6;var or=20;var ir=.5;var ur=1;var fr;var sr;var cr=new Array;function lr(r,t){var n=Math.floor((t-or)/(er+ar));var e=Math.floor((r-or)/(er+ar));return Array(n,e)}function hr(r){return or+r*(er+ar)}function vr(r){return or+r*(er+ar)}function dr(r){return o(matrix[r])}function mr(r){var t=new Array(16);for(var n=15;n>=0;n--){t[n]=matrix[n][r]}return o(t)}function pr(r,t){if(r<0||r>15||t<0||t>15){return}return matrix[r][t]}function _r(r,t,n){if(r<0||r>15||t<0||t>15){return}var e=document.getElementById("tone-matrix");var a=e.getContext("2d");a.fillStyle=n;a.fillRect(vr(t),hr(r),er,er)}r.set_color=_r;function br(r,t,n){_r(r,t,n)}function yr(r,t,n){if(!pr(r,t-1)){_r(r,t-1,n)}if(!pr(r,t+1)){_r(r,t+1,n)}if(!pr(r-1,t)){_r(r-1,t,n)}if(!pr(r+1,t)){_r(r+1,t,n)}}function xr(r,t,n){if(!pr(r,t-2)){_r(r,t-2,n)}if(!pr(r+1,t-1)){_r(r+1,t-1,n)}if(!pr(r+2,t)){_r(r+2,t,n)}if(!pr(r+1,t+1)){_r(r+1,t+1,n)}if(!pr(r,t+2)){_r(r,t+2,n)}if(!pr(r-1,t+1)){_r(r-1,t+1,n)}if(!pr(r-2,t)){_r(r-2,t,n)}if(!pr(r-1,t-1)){_r(r-1,t-1,n)}}function Mr(){for(var r=15;r>=0;r--){for(var t=15;t>=0;t--){if(matrix[r][t]){_r(r,t,color_on)}else{_r(r,t,color_off)}}}}r.initialise_matrix=function(){matrix=new Array(16);var r=document.getElementById("tone-matrix");var t=r.getContext("2d");for(var n=15;n>=0;n--){matrix[n]=new Array(16);for(var e=15;e>=0;e--){_r(n,e,color_off);matrix[n][e]=false}}kr(r)};function kr(r){r.addEventListener("click",function(r){var t=$(this).offset().left;var n=$(this).offset().top;var e=r.pageX-t;var a=r.pageY-n;var o=lr(e,a);var i=o[0];var u=o[1];if(i<0||i>15||u<0||u>15){return}if(matrix[i][u]==undefined||!matrix[i][u]){matrix[i][u]=true;_r(i,u,color_on)}else{matrix[i][u]=false;_r(i,u,color_off)}},false)}function gr(){for(var r=5;r>=0;r--){var t=Math.floor(Math.random()*16);var n=Math.floor(Math.random()*16);if(!pr(t,n)){_r(t,n,nr)}}for(var r=10;r>=0;r--){var t=Math.floor(Math.random()*16);var n=Math.floor(Math.random()*16);if(!pr(t,n)){_r(t,n,color_off)}}}function wr(r){if(r<0||r>15){return}var t=i(mr(r));for(var n=0;n<=15;n++){if(t[n]){br(n,r,rr);yr(n,r,tr);xr(n,r,nr)}}}function Ir(r){if(r<0||r>15){return}var t=i(mr(r));for(var n=0;n<=15;n++){if(t[n]){br(n,r,color_on);yr(n,r,color_off);xr(n,r,color_off)}}}function Pr(){var r=document.getElementById("tone-matrix");var t=r.getContext("2d");var n;Ar();for(var e=15;e>=0;e--){for(var a=15;a>=0;a--){n=Math.random()>.9;if(n){_r(e,a,color_on);matrix[e][a]=true}else{_r(e,a,color_off);matrix[e][a]=false}}}}r.bindMatrixButtons=function(){$("#clear-matrix").on("click",function(){Ar();$("#play-matrix").attr("value","Play")})};function Cr(){var r=matrix.slice(0);var t=[];for(var n=0;n<=15;n++){t[n]=o(r[15-n])}return o(t)}function Ar(){matrix=new Array(16);var r=document.getElementById("tone-matrix");var t=r.getContext("2d");for(var n=15;n>=0;n--){matrix[n]=new Array(16);for(var e=15;e>=0;e--){_r(n,e,color_off);matrix[n][e]=false}}}r.clear_matrix=Ar;var Sr=r.setTimeout;function Er(r,t){var n=Sr(r,t);cr.push(n)}function Rr(){for(var r=cr.length-1;r>=0;r--){clearTimeout(cr[r])}cr=new Array}function Y(r){var r=r.split("");var t=12;var n=r[0].toUpperCase();switch(n){case"D":t=t+2;break;case"E":t=t+4;break;case"F":t=t+5;break;case"G":t=t+7;break;case"A":t=t+9;break;case"B":t=t+11;break;default:break}if(r.length===2){t=parseInt(r[1])*12+t}else if(r.length===3){switch(r[1]){case"#":t=t+1;break;case"b":t=t-1;break;default:break}t=parseInt(r[2])*12+t}return t}function H(r){return J(note_to_midi_note(r))}function J(r){return 8.1757989156*Math.pow(2,r/12)}function K(r,t){function n(t,n){var e=0;for(var a=1;a<=t;a++){e=e+Math.sin(2*Math.PI*(2*a-1)*r*n)/(2*a-1)}return e}return I(m(function(r){var t=4/Math.PI*n(5,r);if(t>1){return 1}else if(t<-1){return-1}else{return t}},t))}function N(r,t){return P(K(r,t))}function O(r,t){function n(t,n){var e=0;for(var a=0;a<t;a++){e=e+Math.pow(-1,a)*Math.sin((2*a+1)*n*r*Math.PI*2)/Math.pow(2*a+1,2)}return e}return I(m(function(r){var t=8/Math.PI/Math.PI*n(5,r);if(t>1){return 1}else if(t<-1){return-1}else{return t}},t))}function Q(r,t){return P(O(r,t))}function V(r,t){function n(t,n){var e=0;for(var a=1;a<=t;a++){e=e+Math.sin(2*Math.PI*a*r*n)/a}return e}return I(m(function(r){var t=1/2-1/Math.PI*n(5,r);if(t>1){return 1}else if(t<-1){return-1}else{return t}},t))}function W(r,t){return P(V(r,t))}function zr(r){return function(t){if(t>r||t<0){return undefined}else{var n=r/8;var e=Math.log(2)/n;return Math.pow(Math.E,-e*t)}}}function Br(r,t,n,e){return function(a){var o=C(a);var i=p(o);var u=_(o);return P(m(function(a){if(a<r){return i(a)*(a/r)}else if(a<r+t){return(zr(1-n,t)(a-r)+n)*i(a)}else if(a<u-e){return i(a)*n}else if(a<=u){return i(a)*n*zr(e)(a-(u-e))}else{return 0}},u))}}function Lr(r,t,n,e){function a(r,t){if(is_empty_list(r)){return r}else{return pair(pair(t,head(r)),a(tail(r),t+1))}}return S(accumulate(function(e,a){return pair(tail(e)(r(t*head(e),n)),a)},[],a(e,1)))}function Ur(r,t){return Lr(N,J(r),t,list(Br(.4,0,1,0),Br(.6472,1.2,0,0)))}function Fr(r,t){return Lr(Q,J(r),t,list(Br(0,1.03,0,0),Br(0,.64,0,0),Br(0,.4,0,0)))}function Tr(r,t){return Lr(N,J(r),t,list(Br(0,1.2,0,0),Br(0,1.3236,0,0),Br(0,1.5236,0,0),Br(0,1.8142,0,0)))}function qr(r,t){return Lr(W,J(r),t,list(Br(.7,0,1,.3),Br(.7,0,1,.3),Br(.9,0,1,.3),Br(.9,0,1,.3)))}function $r(r,t){return Lr(N,J(r),t,list(Br(.1,0,1,.2),Br(.1,0,1,.3),Br(0,0,.2,.3)))}function Dr(r){var t=r.split("");return s(function(r){return parseInt(r)},o(t))}export_symbol("make_sourcesound",m);export_symbol("get_wave",p);export_symbol("get_duration",_);export_symbol("play",M);export_symbol("sound_to_sourcesound",C);export_symbol("sourcesound_to_sound",P);export_symbol("silence",T);export_symbol("play_concurrently",Z);export_symbol("adsr",Br);export_symbol("stacking_adsr",Lr);export_symbol("sine_sound",B);export_symbol("sawtooth_sound",W);export_symbol("triangle_sound",Q);export_symbol("square_sound",N);export_symbol("midi_note_to_frequency",J);export_symbol("letter_name_to_frequency",H);export_symbol("get_matrix",Cr);export_symbol("clear_matrix",Ar);export_symbol("trombone",Ur);export_symbol("piano",Fr);export_symbol("bell",Tr);export_symbol("violin",qr);export_symbol("cello",$r);export_symbol("string_to_list_of_numbers",Dr);export_symbol("simultaneously",S);export_symbol("consecutively",A);export_symbol("setTimeout",Er);export_symbol("clearAllTimeout",Rr)})(window);